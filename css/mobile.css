/* mobile.css — Teams bar placed statically above map (not floating)
   Modified to ensure stage-time appears visually with/under each stage button.
   - Prefer inline .stage-time inside the stage element; if the stage is small/clipped,
     the JS overlay (.mobile-stage-overlay) will be used — styles for that are included.
   - Make stage elements overflow: visible and positioned relative so child .stage-time can be shown.
   - Keep the rest of your polished layout and responsiveness.
*/

/* Root variables */
:root{
  --team-bar-height: 88px;
  --team-seg-min-w: 96px;
  --team-seg-preferred-w: 140px;
  --team-seg-max-w: 220px;
  --teams-gap: 10px;
  --teams-top: 8px;
  --focus-h: 170;
  --focus-s: 70%;
  --focus-l: 45%;
  --panel-radius: 12px;
  --panel-shadow: 0 12px 36px rgba(0,0,0,0.18);
  --teams-z: 40030;
  --connectors-z: 30005;
}

/* Page base */
html, body { height: 100%; }
body {
  margin: 6px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-touch-callout: none;
  -ms-touch-action: manipulation;
  touch-action: manipulation;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Helvetica Neue";
  color: #111;
  background: transparent;
}

/* map wrapper should be positioned (used by JS or layout) */
.map-wrapper { position: relative; }

/* ----------------------------- Players Panel ----------------------------- */
#playersPanel { display: none !important; }

/* ------------------------------- Teams Bar ------------------------------- */
/* IMPORTANT: changed to non-absolute so bar is in flow (pushes map down) */
#teamsBarMobile {
  position: relative !important;
  top: auto !important;
  left: auto !important;
  width: 100% !important;
  box-sizing: border-box;
  padding: 8px 12px;
  z-index: var(--teams-z);
  pointer-events: auto;
  display: block;
  justify-content: center;
  background: linear-gradient(rgba(255,255,255,0.25), rgba(255,255,255,0.20));
  border-radius: var(--panel-radius);
  box-shadow: var(--panel-shadow);
  gap: 6px;
  margin-bottom: 12px;
}

/* Inner container */
#teamsBarMobile .teams-inner {
  width: 100%;
  max-width: 100%;
  display: flex;
  flex-wrap: wrap;
  gap: var(--teams-gap);
  align-items: flex-start;
  justify-content: center;
  padding: 4px;
  box-sizing: border-box;
}

/* Team segment */
.team-segment {
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  padding: 6px;
  border-radius: 10px;
  background: linear-gradient(rgba(255,255,255,0.30), rgba(255,255,255,0.25));
  box-shadow: 0 6px 18px rgba(0,0,0,0.06);
  cursor: pointer;
  user-select: none;
  position: relative;
  flex: 1 1 calc(var(--team-seg-preferred-w));
  min-width: var(--team-seg-min-w);
  max-width: var(--team-seg-max-w);
  border: 2px solid transparent;
  overflow: visible; /* important so .stage-time (child) isn't clipped */
  transition: transform 140ms ease;
}
.team-segment:active { transform: translateY(1px); }

/* color usage */
.team-segment { --team-color: transparent; border-color: var(--team-color); }
.team-segment .team-title {
  font-weight: 700;
  font-size: 13px;
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--team-color, #0ea5a0);
  padding: 0 6px;
}

.team-segment::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  z-index: -1;
  background: linear-gradient(180deg, rgba(255,255,255,0.35), rgba(255,255,255,0.30));
}
@supports (background: color-mix(in srgb, red 10%, white)) {
  .team-segment::before {
    background: color-mix(in srgb, var(--team-color, transparent) 8%, rgba(255,255,255,0.32));
  }
}

/* players list */
.team-segment .team-players-row {
  display: flex;
  flex-direction: column;
  gap: 4px;
  align-items: center;
  font-size: 12px;
  width: 100%;
  padding: 0 6px;
}
.team-segment .team-player-name {
  padding: 4px 8px;
  border-radius: 8px;
  background: rgba(0,0,0,0.03);
  overflow-wrap: break-word;
  word-wrap: break-word;
  hyphens: auto;
  width: calc(100% - 8px);
  text-align: center;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  line-height: 1.3;
}
.team-segment .team-more {
  padding: 2px 6px;
  border-radius: 8px;
  font-size: 11px;
  color: #444;
}

/* connector notch */
.team-segment::after {
  content: "";
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  bottom: -6px;
  width: 10px;
  height: 6px;
  border-bottom-left-radius: 6px;
  border-bottom-right-radius: 6px;
  background: linear-gradient(180deg, transparent, rgba(0,0,0,0.02));
  pointer-events: none;
}

/* Building highlight */
.building.team-focused {
  outline: 2px solid hsl(var(--focus-h) var(--focus-s) var(--focus-l));
  box-shadow: 0 10px 26px hsla(var(--focus-h), var(--focus-s), var(--focus-l), 0.12);
  transform: translateZ(0);
  transition: box-shadow 180ms, outline 180ms;
}

/* Connectors overlay */
#connectorsSvg {
  position: fixed !important;
  left: 0 !important;
  top: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  pointer-events: none !important;
  z-index: var(--connectors-z) !important;
}

/* ----------------------- Stage elements & time (visibility fixes) ----------------------- */
/* Make stage elements allow visible overflow and be positioned so .stage-time can be shown */
.stages-bar .stage,
.stages .stage,
.stage-segment,
.stage-button,
#stagesBar button,
#stagesBar .stage,
.stage {
  overflow: visible !important;
  position: relative !important;
}

/* If your stage markup uses a specific "inner" container, ensure it allows overflow too */
.stages-bar .stage .stage-inner,
.stages .stage .stage-inner,
.stage .stage-inner {
  overflow: visible !important;
  position: relative;
}

/* Preferred: keep .stage-time as a child and absolutely anchor it under the stage */
.stage-time {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  top: calc(100% + 6px);
  z-index: 99999;
  display: block;
  margin: 0;
  font-size: 12px;
  padding: 4px 8px;
  border-radius: 8px;
  background: rgba(255,255,255,0.95);
  color: #000;
  font-weight: 700;
  white-space: nowrap;
  box-shadow: 0 6px 18px rgba(0,0,0,0.09);
  pointer-events: none;
}

/* If the inline time should remain inside flow (not absolute), provide an inline variant */
.stage-time.inline {
  position: relative;
  transform: none;
  top: 0;
  left: 0;
  margin-top: 6px;
  background: rgba(255,255,255,0.06);
  color: inherit;
  box-shadow: none;
  pointer-events: auto;
}

/* Overlay used by JS when inline is clipped */
.mobile-stage-overlay {
  position: fixed;
  pointer-events: none;
  z-index: 65000;
  background: rgba(255,255,255,0.95);
  color: #000;
  padding: 4px 8px;
  border-radius: 8px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.12);
  font-weight: 700;
  font-size: 12px;
  text-align: center;
  white-space: nowrap;
}

/* Responsive */
@media (max-width:900px){
  :root { --team-seg-preferred-w: 120px; --team-seg-min-w: 88px; }
}
@media (max-width:480px){
  :root { --team-seg-preferred-w: 96px; --team-seg-min-w: 72px; --team-bar-height: 92px; }
  #teamsBarMobile { padding: 6px; margin-bottom: 10px; }
  .team-segment { min-width: var(--team-seg-min-w); max-width: 160px; }
  .team-segment .team-player-name { font-size: 12px; }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  #teamsBarMobile, .team-segment, #connectorsSvg { transition: none !important; }
  .team-segment { transform: none !important; }
}

/* utility */
.sr-only { position: absolute !important; height: 1px; width: 1px; overflow: hidden; clip: rect(1px,1px,1px,1px); white-space:nowrap; }